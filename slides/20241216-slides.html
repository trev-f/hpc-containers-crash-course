<!DOCTYPE html>
<html lang="en"><head>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-html/tabby.min.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-html.min.css" rel="stylesheet" data-mode="light">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/quarto-contrib/kbd/kbd.js"></script>
<link href="../site_libs/quarto-contrib/kbd/kbd.css" rel="stylesheet"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.4.552">

  <meta name="author" content="Trevor F. Freeman">
  <meta name="dcterms.date" content="2024-12-16">
  <title>HPC Containers Crash Course - Using Containerized Software on HPC for Bioinformatics</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="../site_libs/revealjs/dist/theme/quarto.css">
  <link href="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">

  .callout {
    margin-top: 1em;
    margin-bottom: 1em;  
    border-radius: .25rem;
  }

  .callout.callout-style-simple { 
    padding: 0em 0.5em;
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
    display: flex;
  }

  .callout.callout-style-default {
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
  }

  .callout .callout-body-container {
    flex-grow: 1;
  }

  .callout.callout-style-simple .callout-body {
    font-size: 1rem;
    font-weight: 400;
  }

  .callout.callout-style-default .callout-body {
    font-size: 0.9rem;
    font-weight: 400;
  }

  .callout.callout-titled.callout-style-simple .callout-body {
    margin-top: 0.2em;
  }

  .callout:not(.callout-titled) .callout-body {
      display: flex;
  }

  .callout:not(.no-icon).callout-titled.callout-style-simple .callout-content {
    padding-left: 1.6em;
  }

  .callout.callout-titled .callout-header {
    padding-top: 0.2em;
    margin-bottom: -0.2em;
  }

  .callout.callout-titled .callout-title  p {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }
    
  .callout.callout-titled.callout-style-simple .callout-content  p {
    margin-top: 0;
  }

  .callout.callout-titled.callout-style-default .callout-content  p {
    margin-top: 0.7em;
  }

  .callout.callout-style-simple div.callout-title {
    border-bottom: none;
    font-size: .9rem;
    font-weight: 600;
    opacity: 75%;
  }

  .callout.callout-style-default  div.callout-title {
    border-bottom: none;
    font-weight: 600;
    opacity: 85%;
    font-size: 0.9rem;
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-default div.callout-content {
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-simple .callout-icon::before {
    height: 1rem;
    width: 1rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 1rem 1rem;
  }

  .callout.callout-style-default .callout-icon::before {
    height: 0.9rem;
    width: 0.9rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 0.9rem 0.9rem;
  }

  .callout-title {
    display: flex
  }
    
  .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  .callout.no-icon::before {
    display: none !important;
  }

  .callout.callout-titled .callout-body > .callout-content > :last-child {
    padding-bottom: 0.5rem;
    margin-bottom: 0;
  }

  .callout.callout-titled .callout-icon::before {
    margin-top: .5rem;
    padding-right: .5rem;
  }

  .callout:not(.callout-titled) .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  /* Callout Types */

  div.callout-note {
    border-left-color: #4582ec !important;
  }

  div.callout-note .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEU0lEQVRYCcVXTWhcVRQ+586kSUMMxkyaElstCto2SIhitS5Ek8xUKV2poatCcVHtUlFQk8mbaaziwpWgglJwVaquitBOfhQXFlqlzSJpFSpIYyXNjBNiTCck7x2/8/LeNDOZxDuEkgOXe++553zfefee+/OYLOXFk3+1LLrRdiO81yNqZ6K9cG0P3MeFaMIQjXssE8Z1JzLO9ls20MBZX7oG8w9GxB0goaPrW5aNMp1yOZIa7Wv6o2ykpLtmAPs/vrG14Z+6d4jpbSKuhdcSyq9wGMPXjonwmESXrriLzFGOdDBLB8Y6MNYBu0dRokSygMA/mrun8MGFN3behm6VVAwg4WR3i6FvYK1T7MHo9BK7ydH+1uurECoouk5MPRyVSBrBHMYwVobG2aOXM07sWrn5qgB60rc6mcwIDJtQrnrEr44kmy+UO9r0u9O5/YbkS9juQckLed3DyW2XV/qWBBB3ptvI8EUY3I9p/67OW+g967TNr3Sotn3IuVlfMLVnsBwH4fsnebJvyGm5GeIUA3jljERmrv49SizPYuq+z7c2H/jlGC+Ghhupn/hcapqmcudB9jwJ/3jvnvu6vu5lVzF1fXyZuZZ7U8nRmVzytvT+H3kilYvH09mLWrQdwFSsFEsxFVs5fK7A0g8gMZjbif4ACpKbjv7gNGaD8bUrlk8x+KRflttr22JEMRUbTUwwDQScyzPgedQHZT0xnx7ujw2jfVfExwYHwOsDTjLdJ2ebmeQIlJ7neo41s/DrsL3kl+W2lWvAga0tR3zueGr6GL78M3ifH0rGXrBC2aAR8uYcIA5gwV8zIE8onoh8u0Fca/ciF7j1uOzEnqcIm59sEXoGc0+z6+H45V1CvAvHcD7THztu669cnp+L0okAeIc6zjbM/24LgGM1gZk7jnRu1aQWoU9sfUOuhrmtaPIO3YY1KLLWZaEO5TKUbMY5zx8W9UJ6elpLwKXbsaZ4EFl7B4bMtDv0iRipKoDQT2sNQI9b1utXFdYisi+wzZ/ri/1m7QfDgEuvgUUEIJPq3DhX/5DWNqIXDOweC2wvIR90Oq3lDpdMIgD2r0dXvGdsEW5H6x6HLRJYU7C69VefO1x8Gde1ZFSJLfWS1jbCnhtOPxmpfv2LXOA2Xk2tvnwKKPFuZ/oRmwBwqRQDcKNeVQkYcOjtWVBuM/JuYw5b6isojIkYxyYAFn5K7ZBF10fea52y8QltAg6jnMqNHFBmGkQ1j+U43HMi2xMar1Nv0zGsf1s8nUsmUtPOOrbFIR8bHFDMB5zL13Gmr/kGlCkUzedTzzmzsaJXhYawnA3UmARpiYj5ooJZiUoxFRtK3X6pgNPv+IZVPcnwbOl6f+aBaO1CNvPW9n9LmCp01nuSaTRF2YxHqZ8DYQT6WsXT+RD6eUztwYLZ8rM+rcPxamv1VQzFUkzFXvkiVrySGQgJNvXHJAxiU3/NwiC03rSf05VBaPtu/Z7/B8Yn/w7eguloAAAAAElFTkSuQmCC');
  }

  div.callout-note.callout-style-default .callout-title {
    background-color: #dae6fb
  }

  div.callout-important {
    border-left-color: #d9534f !important;
  }

  div.callout-important .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEKklEQVRYCcVXTWhcVRS+575MJym48A+hSRFr00ySRQhURRfd2HYjk2SSTokuBCkU2o0LoSKKraKIBTcuFCoidGFD08nkBzdREbpQ1EDNIv8qSGMFUboImMSZd4/f9zJv8ibJMC8xJQfO3HPPPef7zrvvvnvviIkpC9nsw0UttFunbUhpFzFtarSd6WJkStVMw5xyVqYTvkwfzuf/5FgtkVoB0729j1rjXwThS7Vio+Mo6DNnvLfahoZ+i/o32lULuJ3NNiz7q6+pyAUkJaFF6JwaM2lUJlV0MlnQn5aTRbEu0SEqHUa0A4AdiGuB1kFXRfVyg5d87+Dg4DL6m2TLAub60ilj7A1Ec4odSAc8X95sHh7+ZRPCFo6Fnp7HfU/fBng/hi10CjCnWnJjsxvDNxWw0NfV6Rv5GgP3I3jGWXumdTD/3cbEOP2ZbOZp69yniG3FQ9z1jD7bnBu9Fc2tKGC2q+uAJOQHBDRiZX1x36o7fWBs7J9ownbtO+n0/qWkvW7UPIfc37WgT6ZGR++EOJyeQDSb9UB+DZ1G6DdLDzyS+b/kBCYGsYgJbSQHuThGKRcw5xdeQf8YdNHsc6ePXrlSYMBuSIAFTGAtQo+VuALo4BX83N190NWZWbynBjhOHsmNfFWLeL6v+ynsA58zDvvAC8j5PkbOcXCMg2PZFk3q8MjI7WAG/Dp9AwP7jdGBOOQkAvlFUB+irtm16I1Zw9YBcpGTGXYmk3kQIC/Cds55l+iMI3jqhjAuaoe+am2Jw5GT3Nbz3CkE12NavmzN5+erJW7046n/CH1RO/RVa8lBLozXk9uqykkGAyRXLWlLv5jyp4RFsG5vGVzpDLnIjTWgnRy2Rr+tDKvRc7Y8AyZq10jj8DqXdnIRNtFZb+t/ZRtXcDiVnzpqx8mPcDWxgARUqx0W1QB9MeUZiNrV4qP+Ehc+BpNgATsTX8ozYKL2NtFYAHc84fG7ndxUPr+AR/iQSns7uSUufAymwDOb2+NjK27lEFocm/EE2WpyIy/Hi66MWuMKJn8RvxIcj87IM5Vh9663ziW36kR0HNenXuxmfaD8JC7tfKbrhFr7LiZCrMjrzTeGx+PmkosrkNzW94ObzwocJ7A1HokLolY+AvkTiD/q1H0cN48c5EL8Crkttsa/AXQVDmutfyku0E7jShx49XqV3MFK8IryDhYVbj7Sj2P2eBxwcXoe8T8idsKKPRcnZw1b+slFTubwUwhktrfnAt7J++jwQtLZcm3sr9LQrjRzz6cfMv9aLvgmnAGvpoaGLxM4mAEaLV7iAzQ3oU0IvD5x9ix3yF2RAAuYAOO2f7PEFWCXZ4C9Pb2UsgDeVnFSpbFK7/IWu7TPTvBqzbGdCHOJQSxiEjt6IyZmxQyEJHv6xyQsYk//moVFsN2zP6fRImjfq7/n/wFDguUQFNEwugAAAABJRU5ErkJggg==');
  }

  div.callout-important.callout-style-default .callout-title {
    background-color: #f7dddc
  }

  div.callout-warning {
    border-left-color: #f0ad4e !important;
  }

  div.callout-warning .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAETklEQVRYCeVWW2gcVRg+58yaTUnizqbipZeX4uWhBEniBaoUX1Ioze52t7sRq6APio9V9MEaoWlVsFasRq0gltaAPuxms8lu0gcviE/FFOstVbSIxgcv6SU7EZqmdc7v9+9mJtNks51NTUH84ed889/PP+cmxP+d5FIbMJmNbpREu4WUkiTtCicKny0l1pIKmBzovF2S+hIJHX8iEu3hZJ5lNZGqyRrGSIQpq15AzF28jgpeY6yk6GVdrfFqdrD6Iw+QlB8g0YS2g7dyQmXM/IDhBhT0UCiRf59lfqmmDvzRt6kByV/m4JjtzuaujMUM2c5Z2d6JdKrRb3K2q6mA+oYVz8JnDdKPmmNthzkAk/lN63sYPgevrguc72aZX/L9C6x09GYyxBgCX4NlvyGUHOKELlm5rXeR1kchuChJt4SSwyddZRXgvwMGvYo4QSlk3/zkHD8UHxwVJA6zjZZqP8v8kK8OWLnIZtLyCAJagYC4rTGW/9Pqj92N/c+LUaAj27movwbi19tk/whRCIE7Q9vyI6yvRpftAKVTdUjOW40X3h5OXsKCdmFcx0xlLJoSuQngnrJe7Kcjm4OMq9FlC7CMmScQANuNvjfP3PjGXDBaUQmbp296S5L4DrpbrHN1T87ZVEZVCzg1FF0Ft+dKrlLukI+/c9ENo+TvlTDbYFvuKPtQ9+l052rXrgKoWkDAFnvh0wTOmYn8R5f4k/jN/fZiCM1tQx9jQQ4ANhqG4hiL0qIFTGViG9DKB7GYzgubnpofgYRwO+DFjh0Zin2m4b/97EDkXkc+f6xYAPX0KK2I/7fUQuwzuwo/L3AkcjugPNixC8cHf0FyPjWlItmLxWw4Ou9YsQCr5fijMGoD/zpdRy95HRysyXA74MWOnscpO4j2y3HAVisw85hX5+AFBRSHt4ShfLFkIMXTqyKFc46xdzQM6XbAi702a7sy04J0+feReMFKp5q9esYLCqAZYw/k14E/xcLLsFElaornTuJB0svMuJINy8xkIYuL+xPAlWRceH6+HX7THJ0djLUom46zREu7tTkxwmf/FdOZ/sh6Q8qvEAiHpm4PJ4a/doJe0gH1t+aHRgCzOvBvJedEK5OFE5jpm4AGP2a8Dxe3gGJ/pAutug9Gp6he92CsSsWBaEcxGx0FHytmIpuqGkOpldqNYQK8cSoXvd+xLxXADw0kf6UkJNFtdo5MOgaLjiQOQHcn+A6h5NuL2s0qsC2LOM75PcF3yr5STuBSAcGG+meA14K/CI21HcS4LBT6tv0QAh8Dr5l93AhZzG5ZJ4VxAqdZUEl9z7WJ4aN+svMvwHHL21UKTd1mqvChH7/Za5xzXBBKrUcB0TQ+Ulgkfbi/H/YT5EptrGzsEK7tR1B7ln9BBwckYfMiuSqklSznIuoIIOM42MQO+QnduCoFCI0bpkzjCjddHPN/F+2Yu+sd9bKNpVwHhbS3LluK/0zgfwD0xYI5dXuzlQAAAABJRU5ErkJggg==');
  }

  div.callout-warning.callout-style-default .callout-title {
    background-color: #fcefdc
  }

  div.callout-tip {
    border-left-color: #02b875 !important;
  }

  div.callout-tip .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAADr0lEQVRYCe1XTWgTQRj9ZjZV8a9SPIkKgj8I1bMHsUWrqYLVg4Ue6v9BwZOxSYsIerFao7UiUryIqJcqgtpimhbBXoSCVxUFe9CTiogUrUp2Pt+3aUI2u5vdNh4dmMzOzHvvezuz8xNFM0mjnbXaNu1MvFWRXkXEyE6aYOYJpdW4IXuA4r0fo8qqSMDBU0v1HJUgVieAXxzCsdE/YJTdFcVIZQNMyhruOMJKXYFoLfIfIvVIMWdsrd+Rpd86ZmyzzjJmLStqRn0v8lzkb4rVIXvnpScOJuAn2ACC65FkPzEdEy4TPWRLJ2h7z4cArXzzaOdKlbOvKKX25Wl00jSnrwVxAg3o4dRxhO13RBSdNvH0xSARv3adTXbBdTf64IWO2vH0LT+cv4GR1DJt+DUItaQogeBX/chhbTBxEiZ6gftlDNXTrvT7co4ub5A6gp9HIcHvzTa46OS5fBeP87Qm0fQkr4FsYgVQ7Qg+ZayaDg9jhg1GkWj8RG6lkeSacrrHgDaxdoBiZPg+NXV/KifMuB6//JmYH4CntVEHy/keA6x4h4CU5oFy8GzrBS18cLJMXcljAKB6INjWsRcuZBWVaS3GDrqB7rdapVIeA+isQ57Eev9eCqzqOa81CY05VLd6SamW2wA2H3SiTbnbSxmzfp7WtKZkqy4mdyAlGx7ennghYf8voqp9cLSgKdqNfa6RdRsAAkPwRuJZNbpByn+RrJi1RXTwdi8RQF6ymDwGMAtZ6TVE+4uoKh+MYkcLsT0Hk8eAienbiGdjJHZTpmNjlbFJNKDVAp2fJlYju6IreQxQ08UJDNYdoLSl6AadO+fFuCQqVMB1NJwPm69T04Wv5WhfcWyfXQB+wXRs1pt+nCknRa0LVzSA/2B+a9+zQJadb7IyyV24YAxKp2Jqs3emZTuNnKxsah+uabKbMk7CbTgJx/zIgQYErIeTKRQ9yD9wxVof5YolPHqaWo7TD6tJlh7jQnK5z2n3+fGdggIOx2kaa2YI9QWarc5Ce1ipNWMKeSG4DysFF52KBmTNMmn5HqCFkwy34rDg05gDwgH3bBi+sgFhN/e8QvRn8kbamCOhgrZ9GJhFDgfcMHzFb6BAtjKpFhzTjwv1KCVuxHvCbsSiEz4CANnj84cwHdFXAbAOJ4LTSAawGWFn5tDhLMYz6nWeU2wJfIhmIJBefcd/A5FWQWGgrWzyORZ3Q6HuV+Jf0Bj+BTX69fm1zWgK7By1YTXchFDORywnfQ7GpzOo6S+qECrsx2ifVQAAAABJRU5ErkJggg==');
  }

  div.callout-tip.callout-style-default .callout-title {
    background-color: #ccf1e3
  }

  div.callout-caution {
    border-left-color: #fd7e14 !important;
  }

  div.callout-caution .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAACV0lEQVRYCdVWzWoUQRCuqp2ICBLJXgITZL1EfQDBW/bkzUMUD7klD+ATSHBEfAIfQO+iXsWDxJsHL96EHAwhgzlkg8nBg25XWb0zIb0zs9muYYWkoKeru+vn664fBqElyZNuyh167NXJ8Ut8McjbmEraKHkd7uAnAFku+VWdb3reSmRV8PKSLfZ0Gjn3a6Xlcq9YGb6tADjn+lUfTXtVmaZ1KwBIvFI11rRXlWlatwIAAv2asaa9mlB9wwygiDX26qaw1yYPzFXg2N1GgG0FMF8Oj+VIx7E/03lHx8UhvYyNZLN7BwSPgekXXLribw7w5/c8EF+DBK5idvDVYtEEwMeYefjjLAdEyQ3M9nfOkgnPTEkYU+sxMq0BxNR6jExrAI31H1rzvLEfRIdgcv1XEdj6QTQAS2wtstEALLG1yEZ3QhH6oDX7ExBSFEkFINXH98NTrme5IOaaA7kIfiu2L8A3qhH9zRbukdCqdsA98TdElyeMe5BI8Rs2xHRIsoTSSVFfCFCWGPn9XHb4cdobRIWABNf0add9jakDjQJpJ1bTXOJXnnRXHRf+dNL1ZV1MBRCXhMbaHqGI1JkKIL7+i8uffuP6wVQAzO7+qVEbF6NbS0LJureYcWXUUhH66nLR5rYmva+2tjRFtojkM2aD76HEGAD3tPtKM309FJg5j/K682ywcWJ3PASCcycH/22u+Bh7Aa0ehM2Fu4z0SAE81HF9RkB21c5bEn4Dzw+/qNOyXr3DCTQDMBOdhi4nAgiFDGCinIa2owCEChUwD8qzd03PG+qdW/4fDzjUMcE1ZpIAAAAASUVORK5CYII=');
  }

  div.callout-caution.callout-style-default .callout-title {
    background-color: #ffe5d0
  }

  </style>
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">Using Containerized Software on HPC for Bioinformatics</h1>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Trevor F. Freeman 
</div>
        <p class="quarto-title-affiliation">
            UTIA Genomics Center
          </p>
    </div>
</div>

  <p class="date">2024-12-16</p>
</section>
<section>
<section id="setup-workshop-environment" class="title-slide slide level1 center">
<h1>Setup workshop environment</h1>

</section>
<section id="login-to-isaac-ng" class="slide level2">
<h2>Login to ISAAC-NG</h2>
<p>Connect to terminal session on ISAAC-NG login node</p>
<p>My preferred: <code>ssh</code> into <code>login.isaac.utk.edu</code></p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Terminal</strong></pre>
</div>
<div class="sourceCode" id="cb1" data-filename="Terminal"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a></a><span class="fu">ssh</span> <span class="op">&lt;</span>netid<span class="op">&gt;</span>@login.isaac.utk.edu</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="setup-workshop-project-directory" class="slide level2">
<h2>Setup workshop project directory</h2>
<ol type="1">
<li>Create project directory in scratch</li>
<li>Navigate into project directory</li>
</ol>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Terminal</strong></pre>
</div>
<div class="sourceCode" id="cb2" data-filename="Terminal"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a></a><span class="co"># set variable for project directory</span></span>
<span id="cb2-2"><a></a><span class="va">proj_dir</span><span class="op">=</span><span class="st">"</span><span class="va">${SCRATCHDIR}</span><span class="st">/hpc-containers-crash-course"</span></span>
<span id="cb2-3"><a></a></span>
<span id="cb2-4"><a></a><span class="co"># create the project directory and navigate into it</span></span>
<span id="cb2-5"><a></a><span class="fu">mkdir</span> <span class="at">-p</span> <span class="st">"</span><span class="va">${proj_dir}</span><span class="st">"</span></span>
<span id="cb2-6"><a></a><span class="bu">cd</span> <span class="st">"</span><span class="va">${proj_dir}</span><span class="st">"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div title="Workshop project directory">
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Workshop project directory</strong></p>
</div>
<div class="callout-content">
<p>Assume that all commands in this mini workshop are run from the top level of this project directory unless explicitly stated otherwise.</p>
</div>
</div>
</div>
</div>
</section>
<section id="start-interactive-compute-session" class="slide level2">
<h2>Start interactive compute session</h2>
<p>Interactive compute session allows us to work directly on a compute node.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Terminal</strong></pre>
</div>
<div class="sourceCode" id="cb3" data-filename="Terminal"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><a></a><span class="ex">srun</span> <span class="dt">\</span></span>
<span id="cb3-2"><a></a>  <span class="at">--account</span> ACF-UTK0011 <span class="dt">\</span></span>
<span id="cb3-3"><a></a>  <span class="at">--partition</span> short <span class="dt">\</span></span>
<span id="cb3-4"><a></a>  <span class="at">--qos</span> short <span class="dt">\</span></span>
<span id="cb3-5"><a></a>  <span class="at">--cpus-per-task</span> 1 <span class="dt">\</span></span>
<span id="cb3-6"><a></a>  <span class="at">--time</span> 02:00:00 <span class="dt">\</span></span>
<span id="cb3-7"><a></a>  <span class="at">--pty</span> <span class="dt">\</span></span>
<span id="cb3-8"><a></a>  /bin/bash <span class="at">-i</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section>
<section>
<section id="setup-toy-example" class="title-slide slide level1 center">
<h1>Setup toy example</h1>

</section>
<section id="toy-example-description" class="slide level2 smaller">
<h2>Toy example description</h2>
<ul>
<li>Perform routine exploratory analysis of genomic alignments:
<ul>
<li>How many alignment records?</li>
<li>What do stats look like?</li>
<li>Can we tell what reference was used?</li>
</ul></li>
</ul>
<div class="fragment">
<ul>
<li>Data files: Alignments in BAM format with accompanying index</li>
</ul>
</div>
<div class="fragment">
<ul>
<li>BAMs are great candidate for exploring containerized software:
<ul>
<li>Typically require specialized software to parse</li>
<li>Common format produced and used by many software tools</li>
</ul></li>
</ul>
</div>
</section>
<section id="fetch-toy-data" class="slide level2">
<h2>Fetch toy data</h2>
<ol type="1">
<li>Make data directory</li>
<li>Download toy data files into directory</li>
</ol>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Terminal</strong></pre>
</div>
<div class="sourceCode" id="cb4" data-filename="Terminal"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><a></a><span class="co"># set variable for directory to store alignments in</span></span>
<span id="cb4-2"><a></a><span class="va">alignments_dir</span><span class="op">=</span><span class="st">"data/alignments"</span></span>
<span id="cb4-3"><a></a><span class="co"># create alignments directory</span></span>
<span id="cb4-4"><a></a><span class="fu">mkdir</span> <span class="at">-p</span> <span class="st">"</span><span class="va">${alignments_dir}</span><span class="st">"</span></span>
<span id="cb4-5"><a></a></span>
<span id="cb4-6"><a></a><span class="co"># download BAM and index</span></span>
<span id="cb4-7"><a></a><span class="fu">wget</span> <span class="dt">\</span></span>
<span id="cb4-8"><a></a>  <span class="at">-P</span> <span class="st">"</span><span class="va">${alignments_dir}</span><span class="st">"</span> <span class="dt">\</span></span>
<span id="cb4-9"><a></a>  https://github.com/trev-f/hpc-containers-crash-course/raw/refs/heads/main/data/alignments/wt_antiflag_ip1_rep1.bam</span>
<span id="cb4-10"><a></a><span class="fu">wget</span> <span class="dt">\</span></span>
<span id="cb4-11"><a></a>  <span class="at">-P</span> <span class="st">"</span><span class="va">${alignments_dir}</span><span class="st">"</span> <span class="dt">\</span></span>
<span id="cb4-12"><a></a>  https://github.com/trev-f/hpc-containers-crash-course/raw/refs/heads/main/data/alignments/wt_antiflag_ip1_rep1.bam.bai</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section>
<section>
<section id="run-software-in-apptainer-containers" class="title-slide slide level1 center">
<h1>Run software in Apptainer containers</h1>

</section>
<section id="get-started-with-apptainer" class="slide level2">
<h2>Get started with Apptainer</h2>
<p>Run Apptainer</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Terminal</strong></pre>
</div>
<div class="sourceCode" id="cb5" data-filename="Terminal"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><a></a><span class="ex">apptainer</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Get help with Apptainer and subcommands</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Terminal</strong></pre>
</div>
<div class="sourceCode" id="cb6" data-filename="Terminal"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><a></a><span class="co"># get help with Apptainer</span></span>
<span id="cb6-2"><a></a><span class="ex">apptainer</span> help</span>
<span id="cb6-3"><a></a></span>
<span id="cb6-4"><a></a><span class="co"># get help with Apptainer subcommands</span></span>
<span id="cb6-5"><a></a><span class="ex">apptainer</span> help pull</span>
<span id="cb6-6"><a></a><span class="co"># same as -h/--help flag</span></span>
<span id="cb6-7"><a></a><span class="ex">apptainer</span> pull <span class="at">-h</span></span>
<span id="cb6-8"><a></a><span class="ex">apptainer</span> pull <span class="at">--help</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="terminology-note-apptainer-is-singularity" class="slide level2">
<h2>Terminology note: Apptainer is Singularity</h2>
<p>Both Apptainer and Singularity commands show same version</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Terminal</strong></pre>
</div>
<div class="sourceCode" id="cb7" data-filename="Terminal"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><a></a><span class="ex">apptainer</span> <span class="at">--version</span></span>
<span id="cb7-2"><a></a><span class="ex">singularity</span> <span class="at">--version</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Running <code>singularity</code> launches Apptainer</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Terminal</strong></pre>
</div>
<div class="sourceCode" id="cb8" data-filename="Terminal"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><a></a><span class="co"># find executables for Apptainer and Singularity</span></span>
<span id="cb8-2"><a></a><span class="fu">which</span> apptainer</span>
<span id="cb8-3"><a></a><span class="fu">which</span> singularity</span>
<span id="cb8-4"><a></a></span>
<span id="cb8-5"><a></a><span class="co"># show more info about those executables</span></span>
<span id="cb8-6"><a></a><span class="fu">ls</span> <span class="at">-lh</span> /usr/bin/apptainer /usr/bin/singularity</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><a href="https://apptainer.org/docs/user/1.2/singularity_compatibility.html">Singularity Compatibility</a> in Apptainer docs</p>
</section>
<section id="configure-apptainer-cache" class="slide level2">
<h2>Configure Apptainer cache</h2>
<p>Set Apptainer to cache images in scratch directory</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>~/.bashrc</strong></pre>
</div>
<div class="sourceCode" id="cb9" data-filename="~/.bashrc"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb9-1"><a></a><span class="bu">export</span> <span class="va">APPTAINER_CACHE</span><span class="op">=</span><span class="st">"</span><span class="va">${SCRATCHDIR}</span><span class="st">/.apptainer/cache"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Restart your shell session to load this environment variable</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Terminal</strong></pre>
</div>
<div class="sourceCode" id="cb10" data-filename="Terminal"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb10-1"><a></a><span class="bu">exec</span> bash</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="fragment">
<div title="Apptainer cache">
<div class="callout callout-important callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Apptainer cache</strong></p>
</div>
<div class="callout-content">
<p>Apptainer does some image management for us. When it fetches an image from a remote location, it caches those images to prevent repeatedly downloading them. By default, it uses <code>$HOME/.apptainer/cache</code> for its cache directory. Home directories on ISAAC-NG are rather small, and Apptainer images can be large, so it makes sense to store these in scratch.</p>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="apptainer-pull-get-apptainer-image-from-remote-uri" class="slide level2">
<h2><code>apptainer pull</code> – Get Apptainer image from remote URI</h2>
<p>View help docs</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Terminal</strong></pre>
</div>
<div class="sourceCode" id="cb11" data-filename="Terminal"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb11-1"><a></a><span class="ex">apptainer</span> help pull</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Basic usage – <code>apptainer pull [output file] &lt;URI&gt;</code></p>
<div class="fragment">
<p>Pull Samtools image – We’ll use Samtools to analyze BAM file</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Terminal</strong></pre>
</div>
<div class="sourceCode" id="cb12" data-filename="Terminal"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb12-1"><a></a><span class="co"># set variable for Samtools image URI</span></span>
<span id="cb12-2"><a></a><span class="va">samtools_img_uri</span><span class="op">=</span><span class="st">"https://depot.galaxyproject.org/singularity/samtools:1.21--h50ea8bc_0"</span></span>
<span id="cb12-3"><a></a></span>
<span id="cb12-4"><a></a><span class="co"># pull the apptainer image</span></span>
<span id="cb12-5"><a></a><span class="ex">apptainer</span> pull samtools_1-21.sif <span class="st">"</span><span class="va">${samtools_img_uri}</span><span class="st">"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
<section id="three-ways-to-interact-with-an-image" class="slide level2 smaller">
<h2>Three ways to interact with an image</h2>
<ol type="1">
<li><code>apptainer shell &lt;image&gt;</code> – Spawn interactive shell in container</li>
</ol>
<ul>
<li>Useful for interactively exploring a container</li>
<li>Not suitable for scripting</li>
</ul>
<div class="fragment">
<ol start="2" type="1">
<li><code>apptainer run &lt;image&gt; [arguments]</code> – Run the container runscript</li>
</ol>
<ul>
<li>Simple way to run software in container</li>
<li>Relies on the way the runscript is specified by the container’s creator</li>
<li>May not accept arguments in expected manner</li>
</ul>
</div>
<div class="fragment">
<ol start="3" type="1">
<li><code>apptainer exec &lt;image&gt; &lt;command&gt;</code> – Execute custom command in container</li>
</ol>
<ul>
<li>Most reliable way to run software in container</li>
<li>Generally works as expected</li>
<li>Recommended for scripting</li>
</ul>
</div>
</section>
<section id="apptainer-shell-basics" class="slide level2 smaller">
<h2><code>apptainer shell</code> – Basics</h2>
<p>Enter interactive shell session in container</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Terminal</strong></pre>
</div>
<div class="sourceCode" id="cb13" data-filename="Terminal"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb13-1"><a></a><span class="ex">apptainer</span> shell samtools_1-21.sif</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="fragment">
<p>How to tell you’re in container shell session:</p>
<ol type="1">
<li>Command prompt says “Singularity” – Unreliable</li>
<li><code>echo "${APPTAINER_NAME}"</code> prints name of container</li>
</ol>
</div>
<div class="fragment">
<p>Exit interactive shell session and close container</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Apptainer shell</strong></pre>
</div>
<div class="sourceCode" id="cb14" data-filename="Apptainer shell"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb14-1"><a></a><span class="bu">exit</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>May also be able to use <kbd aria-hidden="true">Ctrl-d</kbd><span class="visually-hidden">Ctrl-d</span></p>
</div>
</section>
<section id="apptainer-shell-software-in-the-samtools-container" class="slide level2 smaller">
<h2><code>apptainer shell</code> – Software in the Samtools container</h2>
<p>Enter interactive shell session in container</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Terminal</strong></pre>
</div>
<div class="sourceCode" id="cb15" data-filename="Terminal"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb15-1"><a></a><span class="ex">apptainer</span> shell samtools_1-21.sif</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="fragment">
<p>Samtools is available inside the container</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Apptainer shell</strong></pre>
</div>
<div class="sourceCode" id="cb16" data-filename="Apptainer shell"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb16-1"><a></a><span class="co"># show samtools help</span></span>
<span id="cb16-2"><a></a><span class="ex">samtools</span> version</span>
<span id="cb16-3"><a></a><span class="co"># show information about the samtools command</span></span>
<span id="cb16-4"><a></a><span class="bu">type</span> samtools</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="fragment">
<p>Software available on the ISAAC-NG host OS may not be available in the container</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Apptainer shell</strong></pre>
</div>
<div class="sourceCode" id="cb17" data-filename="Apptainer shell"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb17-1"><a></a><span class="co"># commands that aren't available in the container will fail</span></span>
<span id="cb17-2"><a></a><span class="ex">apptainer</span> <span class="at">--version</span></span>
<span id="cb17-3"><a></a><span class="ex">module</span> avail</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
<section id="apptainer-shell-files-in-the-samtools-container" class="slide level2">
<h2><code>apptainer shell</code> – Files in the Samtools container</h2>
<p>Directly access files in project directory</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Apptainer shell</strong></pre>
</div>
<div class="sourceCode" id="cb18" data-filename="Apptainer shell"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb18-1"><a></a><span class="co"># print BAM file header</span></span>
<span id="cb18-2"><a></a><span class="ex">samtools</span> head data/alignments/wt_antiflag_ip1_rep1.bam</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="fragment">
<p>Thanks to the ISAAC-NG sys admins, all of your favorite ISAAC-NG directories are accessible inside of containers right where we expect them to be!</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Apptainer shell</strong></pre>
</div>
<div class="sourceCode" id="cb19" data-filename="Apptainer shell"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb19-1"><a></a><span class="co"># look into your home and scratch directories</span></span>
<span id="cb19-2"><a></a><span class="fu">ls</span> <span class="st">"</span><span class="va">${HOME}</span><span class="st">"</span></span>
<span id="cb19-3"><a></a><span class="fu">ls</span> <span class="st">"</span><span class="va">${SCRATCHDIR}</span><span class="st">"</span></span>
<span id="cb19-4"><a></a></span>
<span id="cb19-5"><a></a><span class="co"># look into the list of project directories</span></span>
<span id="cb19-6"><a></a><span class="fu">ls</span> /lustre/isaac/proj</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
<section id="apptainer-run-relies-on-runscript" class="slide level2 smaller">
<h2><code>apptainer run</code> – Relies on runscript</h2>
<p>View runscript built into container – May be hard to parse</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Terminal</strong></pre>
</div>
<div class="sourceCode" id="cb20" data-filename="Terminal"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb20-1"><a></a><span class="co"># print the runscript</span></span>
<span id="cb20-2"><a></a><span class="ex">apptainer</span> inspect <span class="at">--runscript</span> samtools_1-21.sif</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="fragment">
<p>Run the Samtools container</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Terminal</strong></pre>
</div>
<div class="sourceCode" id="cb21" data-filename="Terminal"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb21-1"><a></a><span class="co"># run the samtools container runscript</span></span>
<span id="cb21-2"><a></a><span class="ex">apptainer</span> run samtools_1-21.sif</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Run Samtools in the Samtools container</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Terminal</strong></pre>
</div>
<div class="sourceCode" id="cb22" data-filename="Terminal"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb22-1"><a></a><span class="co"># run samtools in the samtools container runscript by supplying command line args</span></span>
<span id="cb22-2"><a></a><span class="ex">apptainer</span> run samtools_1-21.sif samtools head data/alignments/wt_antiflag_ip1_rep1.bam</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="fragment">
<div title="apptainer run">
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>apptainer run</strong></p>
</div>
<div class="callout-content">
<p>Running this command is completely dependent on how the runscript is setup</p>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="apptainer-exec-execute-samtools-directly-in-container" class="slide level2">
<h2><code>apptainer exec</code> – Execute samtools directly in container</h2>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Terminal</strong></pre>
</div>
<div class="sourceCode" id="cb23" data-filename="Terminal"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb23-1"><a></a><span class="co"># print BAM file header with command directly executed in container</span></span>
<span id="cb23-2"><a></a><span class="ex">apptainer</span> exec samtools_1-21.sif samtools head data/alignments/wt_antiflag_ip1_rep1.bam</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="fragment">
<div title="apptainer exec">
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>apptainer exec</strong></p>
</div>
<div class="callout-content">
<p>Running this command is completely independent from how the container is setup.</p>
<p>If 1) the software is available in the container and 2) the file can be accessed in the container, the command should run</p>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="run-apptainer-conclusions-useful-commands" class="slide level2">
<h2>Run Apptainer conclusions – Useful commands</h2>
<ul>
<li>Get Apptainer image from remote URI – <code>apptainer pull</code></li>
</ul>
<div class="fragment">
<ul>
<li>Interact with Apptainer image with one of three commands
<ul>
<li>Explore container – <code>apptainer shell</code></li>
<li>Execute command inside container – <code>apptainer exec</code></li>
<li>Run specific script that you know has been set as runscript – <code>apptainer run</code></li>
</ul></li>
</ul>
</div>
</section>
<section id="run-apptainer-conclusions-software-and-files" class="slide level2">
<h2>Run Apptainer conclusions – Software and files</h2>
<ul>
<li>You shouldn’t need to bind any files into Apptainer containers on ISAAC-NG for normal use
<ul>
<li>Sys admins took care of this for you!</li>
<li>Caveat: Some (rare) containers may expect files in specific locations. Look into <a href="https://apptainer.org/docs/user/1.2/bind_paths_and_mounts.html">bind paths and mounts</a></li>
</ul></li>
</ul>
<div class="fragment">
<ul>
<li>Containers allow you to run the software that is available inside the container</li>
<li>You cannot run software available on the host OS inside the container</li>
</ul>
</div>
</section></section>
<section>
<section id="apptainer-containers-in-use-analyze-the-toy-example" class="title-slide slide level1 center">
<h1>Apptainer containers in use – Analyze the toy example</h1>

</section>
<section id="get-quick-alignments-info" class="slide level2">
<h2>Get quick alignments info</h2>
<p>Count records in BAM with Samtools – <code>samtools view -c &lt;input.bam&gt;</code></p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Terminal</strong></pre>
</div>
<div class="sourceCode" id="cb24" data-filename="Terminal"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb24-1"><a></a><span class="ex">apptainer</span> exec samtools_1-21.sif samtools view <span class="at">-c</span> data/alignments/wt_antiflag_ip1_rep1.bam</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="fragment">
<p>Quick alignment stats – <code>samtools flagstat &lt;input.bam&gt;</code></p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Terminal</strong></pre>
</div>
<div class="sourceCode" id="cb25" data-filename="Terminal"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb25-1"><a></a><span class="ex">apptainer</span> exec samtools_1-21.sif samtools view <span class="at">-c</span> data/alignments/wt_antiflag_ip1_rep1.bam</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
<section id="get-info-about-high-quality-alignments" class="slide level2 smaller">
<h2>Get info about high quality alignments</h2>
<p>Count high quality records in BAM – <code>samtools view -c -q 10 &lt;input.bam&gt;</code></p>
<p>Filters reads by minimum MAPQ (mapping quality)</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Terminal</strong></pre>
</div>
<div class="sourceCode" id="cb26" data-filename="Terminal"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb26-1"><a></a><span class="ex">apptainer</span> exec samtools_1-21.sif samtools view <span class="at">-c</span> <span class="at">-q</span> 10 data/alignments/wt_antiflag_ip1_rep1.bam</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="fragment">
<p>Quick alignment stats of filtered BAM file – <code>samtools view -h -q 10 &lt;input.bam&gt; | samtools flagstat -</code></p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Terminal</strong></pre>
</div>
<div class="sourceCode" id="cb27" data-filename="Terminal"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb27-1"><a></a><span class="ex">apptainer</span> exec samtools_1-21.sif samtools view <span class="at">-q</span> 10 <span class="at">-h</span> data/alignments/wt_antiflag_ip1_rep1.bam <span class="kw">|</span> <span class="ex">samtools</span> flagstat <span class="at">-</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="fragment">
<div title="Pipes in Apptainer">
<div class="callout callout-important callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Pipes in Apptainer</strong></p>
</div>
<div class="callout-content">
<p>Apptainer containers work with pipes and redirects. <code>stdout</code>/<code>stdin</code>/<code>stderr</code> goes back and forth between the container and our OS. In the command above, the filtered BAM stream from the container is piped into the <code>samtools</code> command executed on <em>our OS</em>. We don’t have the <code>samtools</code> command available on our OS, so this fails.</p>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="get-high-quality-alignments-quick-stats" class="slide level2">
<h2>Get high quality alignments quick stats</h2>
<p>Pipe out of one container and into another:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Terminal</strong></pre>
</div>
<div class="sourceCode" id="cb28" data-filename="Terminal"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb28-1"><a></a><span class="ex">apptainer</span> exec samtools_1-21.sif samtools view <span class="at">-q</span> 10 <span class="at">-h</span> data/alignments/wt_antiflag_ip1_rep1.bam <span class="kw">|</span> <span class="ex">apptainer</span> exec samtools_1-21.sif samtools flagstat <span class="at">-</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="package-bam-analysis-into-a-script" class="slide level2 smaller">
<h2>Package BAM analysis into a script</h2>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>compute_bam_stats.sh</strong></pre>
</div>
<div class="sourceCode" id="cb29" data-filename="compute_bam_stats.sh"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb29-1"><a></a><span class="co"># get input bam file from command line argument</span></span>
<span id="cb29-2"><a></a><span class="va">input_bam</span><span class="op">=</span><span class="st">"</span><span class="va">${1}</span><span class="st">"</span></span>
<span id="cb29-3"><a></a><span class="bu">echo</span> <span class="st">"Input BAM file: </span><span class="va">${input_bam}</span><span class="st">"</span></span>
<span id="cb29-4"><a></a></span>
<span id="cb29-5"><a></a><span class="co"># pull samtools image if it doesn't already exist</span></span>
<span id="cb29-6"><a></a><span class="va">samtools_img_uri</span><span class="op">=</span><span class="st">"https://depot.galaxyproject.org/singularity/samtools:1.21--h50ea8bc_0"</span></span>
<span id="cb29-7"><a></a><span class="cf">if</span> <span class="bu">[</span> <span class="ot">!</span> <span class="ot">-e</span> samtools_1-21.sif <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb29-8"><a></a>  <span class="ex">apptainer</span> pull samtools_1-21.sif <span class="st">"</span><span class="va">${samtools_img_uri}</span><span class="st">"</span></span>
<span id="cb29-9"><a></a><span class="cf">fi</span></span>
<span id="cb29-10"><a></a></span>
<span id="cb29-11"><a></a><span class="co"># print alignment stats</span></span>
<span id="cb29-12"><a></a><span class="bu">echo</span> <span class="st">"Number records in BAM:"</span></span>
<span id="cb29-13"><a></a><span class="ex">apptainer</span> exec samtools_1-21.sif samtools view <span class="at">-c</span> <span class="st">"</span><span class="va">${input_bam}</span><span class="st">"</span></span>
<span id="cb29-14"><a></a><span class="bu">echo</span> <span class="st">"BAM quick stats:"</span></span>
<span id="cb29-15"><a></a><span class="ex">apptainer</span> exec samtools_1-21.sif samtools flagstat <span class="st">"</span><span class="va">${input_bam}</span><span class="st">"</span></span>
<span id="cb29-16"><a></a></span>
<span id="cb29-17"><a></a><span class="co"># print alignment stats for high quality alignments</span></span>
<span id="cb29-18"><a></a><span class="bu">echo</span> <span class="st">"Number high quality records in BAM:"</span></span>
<span id="cb29-19"><a></a><span class="ex">apptainer</span> exec samtools_1-21.sif samtools view <span class="at">-c</span> <span class="at">-q</span> 10 <span class="st">"</span><span class="va">${input_bam}</span><span class="st">"</span></span>
<span id="cb29-20"><a></a><span class="bu">echo</span> <span class="st">"High quality BAM quick stats:"</span></span>
<span id="cb29-21"><a></a><span class="ex">apptainer</span> exec samtools_1-21.sif samtools view <span class="at">-h</span> <span class="at">-q</span> 10 <span class="st">"</span><span class="va">${input_bam}</span><span class="st">"</span> <span class="kw">|</span> <span class="ex">apptainer</span> exec samtools_1-21.sif samtools flagstat <span class="at">-</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Run the BAM stats script</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Terminal</strong></pre>
</div>
<div class="sourceCode" id="cb30" data-filename="Terminal"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb30-1"><a></a><span class="fu">bash</span> compute_bam_stats.sh data/alignments/wt_antiflag_ip1_rep1.bam</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section>
<section>
<section id="simplify-apptainer-usage" class="title-slide slide level1 center">
<h1>Simplify Apptainer usage</h1>

</section>
<section id="script-is-full-of-duplicated-code" class="slide level2 smaller">
<h2>Script is full of duplicated code</h2>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>compute_bam_stats.sh</strong></pre>
</div>
<div class="sourceCode" id="cb31" data-filename="compute_bam_stats.sh"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb31-1"><a></a><span class="co"># get input bam file from command line argument</span></span>
<span id="cb31-2"><a></a><span class="va">input_bam</span><span class="op">=</span><span class="st">"</span><span class="va">${1}</span><span class="st">"</span></span>
<span id="cb31-3"><a></a><span class="bu">echo</span> <span class="st">"Input BAM file: </span><span class="va">${input_bam}</span><span class="st">"</span></span>
<span id="cb31-4"><a></a></span>
<span id="cb31-5"><a></a><span class="co"># pull samtools image if it doesn't already exist</span></span>
<span id="cb31-6"><a></a><span class="va">samtools_img_uri</span><span class="op">=</span><span class="st">"https://depot.galaxyproject.org/singularity/samtools:1.21--h50ea8bc_0"</span></span>
<span id="cb31-7"><a></a><span class="cf">if</span> <span class="bu">[</span> <span class="ot">!</span> <span class="ot">-e</span> samtools_1-21.sif <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb31-8"><a></a>  <span class="ex">apptainer</span> pull samtools_1-21.sif <span class="st">"</span><span class="va">${samtools_img_uri}</span><span class="st">"</span></span>
<span id="cb31-9"><a></a><span class="cf">fi</span></span>
<span id="cb31-10"><a></a></span>
<span id="cb31-11"><a></a><span class="co"># print alignment stats</span></span>
<span id="cb31-12"><a></a><span class="bu">echo</span> <span class="st">"Number records in BAM:"</span></span>
<span id="cb31-13"><a></a><span class="ex">apptainer</span> exec samtools_1-21.sif samtools view <span class="at">-c</span> <span class="st">"</span><span class="va">${input_bam}</span><span class="st">"</span></span>
<span id="cb31-14"><a></a><span class="bu">echo</span> <span class="st">"BAM quick stats:"</span></span>
<span id="cb31-15"><a></a><span class="ex">apptainer</span> exec samtools_1-21.sif samtools flagstat <span class="st">"</span><span class="va">${input_bam}</span><span class="st">"</span></span>
<span id="cb31-16"><a></a></span>
<span id="cb31-17"><a></a><span class="co"># print alignment stats for high quality alignments</span></span>
<span id="cb31-18"><a></a><span class="bu">echo</span> <span class="st">"Number high quality records in BAM:"</span></span>
<span id="cb31-19"><a></a><span class="ex">apptainer</span> exec samtools_1-21.sif samtools view <span class="at">-c</span> <span class="at">-q</span> 10 <span class="st">"</span><span class="va">${input_bam}</span><span class="st">"</span></span>
<span id="cb31-20"><a></a><span class="bu">echo</span> <span class="st">"High quality BAM quick stats:"</span></span>
<span id="cb31-21"><a></a><span class="ex">apptainer</span> exec samtools_1-21.sif samtools view <span class="at">-h</span> <span class="at">-q</span> 10 <span class="st">"</span><span class="va">${input_bam}</span><span class="st">"</span> <span class="kw">|</span> <span class="ex">apptainer</span> exec samtools_1-21.sif samtools flagstat <span class="at">-</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Numerous explicit uses of <code>apptainer pull/exec samtools_1-21.sif</code></p>
<ul>
<li>Difficult to maintain – What if we want to update to Samtools v1.22?</li>
<li>Error prone</li>
</ul>
</section>
<section id="simplify-script-use-variable-for-image-path" class="slide level2 smaller">
<h2>Simplify script – Use variable for image path</h2>
<p>Simple refactor: Replace explicit references to image path with a variable</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>compute_bam_stats.sh</strong></pre>
</div>
<div class="sourceCode" id="cb32" data-filename="compute_bam_stats.sh"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb32-1"><a></a><span class="co"># get input bam file from command line argument</span></span>
<span id="cb32-2"><a></a><span class="va">input_bam</span><span class="op">=</span><span class="st">"</span><span class="va">${1}</span><span class="st">"</span></span>
<span id="cb32-3"><a></a><span class="bu">echo</span> <span class="st">"Input BAM file: </span><span class="va">${input_bam}</span><span class="st">"</span></span>
<span id="cb32-4"><a></a></span>
<span id="cb32-5"><a></a><span class="co"># set Samtools remote image URI and local image path</span></span>
<span id="cb32-6"><a></a><span class="va">samtools_img_uri</span><span class="op">=</span><span class="st">"https://depot.galaxyproject.org/singularity/samtools:1.21--h50ea8bc_0"</span></span>
<span id="cb32-7"><a></a><span class="va">samtools_img_path</span><span class="op">=</span><span class="st">"samtools_1-21.sif"</span></span>
<span id="cb32-8"><a></a></span>
<span id="cb32-9"><a></a><span class="co"># pull samtools image if it doesn't already exist</span></span>
<span id="cb32-10"><a></a><span class="cf">if</span> <span class="bu">[</span> <span class="ot">!</span> <span class="ot">-e</span> <span class="st">"</span><span class="va">${samtools_img_path}</span><span class="st">"</span> <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb32-11"><a></a>  <span class="ex">apptainer</span> pull <span class="st">"</span><span class="va">${samtools_img_path}</span><span class="st">"</span> <span class="st">"</span><span class="va">${samtools_img_uri}</span><span class="st">"</span></span>
<span id="cb32-12"><a></a><span class="cf">fi</span></span>
<span id="cb32-13"><a></a></span>
<span id="cb32-14"><a></a><span class="co"># print alignment stats</span></span>
<span id="cb32-15"><a></a><span class="bu">echo</span> <span class="st">"Number records in BAM:"</span></span>
<span id="cb32-16"><a></a><span class="ex">apptainer</span> exec <span class="st">"</span><span class="va">${samtools_img_path}</span><span class="st">"</span> samtools view <span class="at">-c</span> <span class="st">"</span><span class="va">${input_bam}</span><span class="st">"</span></span>
<span id="cb32-17"><a></a><span class="bu">echo</span> <span class="st">"BAM quick stats:"</span></span>
<span id="cb32-18"><a></a><span class="ex">apptainer</span> exec <span class="st">"</span><span class="va">${samtools_img_path}</span><span class="st">"</span> samtools flagstat <span class="st">"</span><span class="va">${input_bam}</span><span class="st">"</span></span>
<span id="cb32-19"><a></a></span>
<span id="cb32-20"><a></a><span class="co"># print alignment stats for high quality alignments</span></span>
<span id="cb32-21"><a></a><span class="bu">echo</span> <span class="st">"Number high quality records in BAM:"</span></span>
<span id="cb32-22"><a></a><span class="ex">apptainer</span> exec <span class="st">"</span><span class="va">${samtools_img_path}</span><span class="st">"</span> samtools view <span class="at">-c</span> <span class="at">-q</span> 10 <span class="st">"</span><span class="va">${input_bam}</span><span class="st">"</span></span>
<span id="cb32-23"><a></a><span class="bu">echo</span> <span class="st">"High quality BAM quick stats:"</span></span>
<span id="cb32-24"><a></a><span class="ex">apptainer</span> exec <span class="st">"</span><span class="va">${samtools_img_path}</span><span class="st">"</span> samtools view <span class="at">-h</span> <span class="at">-q</span> 10 <span class="st">"</span><span class="va">${input_bam}</span><span class="st">"</span> <span class="kw">|</span> <span class="ex">apptainer</span> exec <span class="st">"</span><span class="va">${samtools_img_path}</span><span class="st">"</span> samtools flagstat <span class="at">-</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="execute-container-directly-from-remote-image-uri" class="slide level2">
<h2>Execute container directly from remote image URI</h2>
<p>Check <code>apptainer exec</code> docs.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Terminal</strong></pre>
</div>
<div class="sourceCode" id="cb33" data-filename="Terminal"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb33-1"><a></a><span class="ex">apptainer</span> help exec</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Many URI types are listed as valid <code>&lt;container&gt;</code> options. <code>https://*</code> is not among them, but it works.</p>
<div class="fragment">
<p><code>apptainer exec</code> with remote image URI pulls and caches remote image and executes command inside container</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Terminal</strong></pre>
</div>
<div class="sourceCode" id="cb34" data-filename="Terminal"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb34-1"><a></a><span class="co"># set variable for Samtools image URI</span></span>
<span id="cb34-2"><a></a><span class="va">samtools_img_uri</span><span class="op">=</span><span class="st">"https://depot.galaxyproject.org/singularity/samtools:1.21--h50ea8bc_0"</span></span>
<span id="cb34-3"><a></a></span>
<span id="cb34-4"><a></a><span class="co"># run samtools from the container using its URI</span></span>
<span id="cb34-5"><a></a><span class="ex">apptainer</span> exec <span class="st">"</span><span class="va">${samtools_img_uri}</span><span class="st">"</span> samtools view <span class="at">-c</span> data/alignments/wt_antiflag_ip1_rep1.bam</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
<section id="simplify-script-execute-from-remote-image-uri" class="slide level2 smaller">
<h2>Simplify script – Execute from remote image URI</h2>
<p>Larger refactor:</p>
<ol type="1">
<li>Remove explicit image pull</li>
<li>Execute from remote image URI instead of local image path</li>
</ol>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>compute_bam_stats.sh</strong></pre>
</div>
<div class="sourceCode" id="cb35" data-filename="compute_bam_stats.sh"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb35-1"><a></a><span class="co"># get input bam file from command line argument</span></span>
<span id="cb35-2"><a></a><span class="va">input_bam</span><span class="op">=</span><span class="st">"</span><span class="va">${1}</span><span class="st">"</span></span>
<span id="cb35-3"><a></a><span class="bu">echo</span> <span class="st">"Input BAM file: </span><span class="va">${input_bam}</span><span class="st">"</span></span>
<span id="cb35-4"><a></a></span>
<span id="cb35-5"><a></a><span class="co"># set Samtools remote image URI</span></span>
<span id="cb35-6"><a></a><span class="va">samtools_img_uri</span><span class="op">=</span><span class="st">"https://depot.galaxyproject.org/singularity/samtools:1.21--h50ea8bc_0"</span></span>
<span id="cb35-7"><a></a></span>
<span id="cb35-8"><a></a><span class="co"># print alignment stats</span></span>
<span id="cb35-9"><a></a><span class="bu">echo</span> <span class="st">"Number records in BAM:"</span></span>
<span id="cb35-10"><a></a><span class="ex">apptainer</span> exec <span class="st">"</span><span class="va">${samtools_img_uri}</span><span class="st">"</span> samtools view <span class="at">-c</span> <span class="st">"</span><span class="va">${input_bam}</span><span class="st">"</span></span>
<span id="cb35-11"><a></a><span class="bu">echo</span> <span class="st">"BAM quick stats:"</span></span>
<span id="cb35-12"><a></a><span class="ex">apptainer</span> exec <span class="st">"</span><span class="va">${samtools_img_uri}</span><span class="st">"</span> samtools flagstat <span class="st">"</span><span class="va">${input_bam}</span><span class="st">"</span></span>
<span id="cb35-13"><a></a></span>
<span id="cb35-14"><a></a><span class="co"># print alignment stats for high quality alignments</span></span>
<span id="cb35-15"><a></a><span class="bu">echo</span> <span class="st">"Number high quality records in BAM:"</span></span>
<span id="cb35-16"><a></a><span class="ex">apptainer</span> exec <span class="st">"</span><span class="va">${samtools_img_uri}</span><span class="st">"</span> samtools view <span class="at">-c</span> <span class="at">-q</span> 10 <span class="st">"</span><span class="va">${input_bam}</span><span class="st">"</span></span>
<span id="cb35-17"><a></a><span class="bu">echo</span> <span class="st">"High quality BAM quick stats:"</span></span>
<span id="cb35-18"><a></a><span class="ex">apptainer</span> exec <span class="st">"</span><span class="va">${samtools_img_uri}</span><span class="st">"</span> samtools view <span class="at">-h</span> <span class="at">-q</span> 10 <span class="st">"</span><span class="va">${input_bam}</span><span class="st">"</span> <span class="kw">|</span> <span class="ex">apptainer</span> exec <span class="st">"</span><span class="va">${samtools_img_uri}</span><span class="st">"</span> samtools flagstat <span class="at">-</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="simulate-loading-software-with-function" class="slide level2 smaller">
<h2>Simulate “loading” software with function</h2>
<p>Abstracts away the fact we’re using a container from the main program logic</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Terminal</strong></pre>
</div>
<div class="sourceCode" id="cb36" data-filename="Terminal"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb36-1"><a></a><span class="co"># make function to execute Samtools in Apptainer container</span></span>
<span id="cb36-2"><a></a><span class="kw">function</span><span class="fu"> samtools</span> <span class="kw">{</span></span>
<span id="cb36-3"><a></a>  <span class="bu">local</span> <span class="va">img_uri</span><span class="op">=</span><span class="st">"https://depot.galaxyproject.org/singularity/samtools:1.21--h50ea8bc_0"</span></span>
<span id="cb36-4"><a></a>  <span class="ex">apptainer</span> exec <span class="st">"</span><span class="va">${img_uri}</span><span class="st">"</span> samtools <span class="st">"</span><span class="va">${@}</span><span class="st">"</span></span>
<span id="cb36-5"><a></a><span class="kw">}</span></span>
<span id="cb36-6"><a></a></span>
<span id="cb36-7"><a></a><span class="co"># run samtools from the container using its function</span></span>
<span id="cb36-8"><a></a><span class="ex">samtools</span> view <span class="at">-c</span> data/alignments/wt_antiflag_ip1_rep1.bam</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="fragment">
<div title="'Load' container from function">
<div class="callout callout-caution callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>‘Load’ container from function</strong></p>
</div>
<div class="callout-content">
<p>The abstraction makes this method powerful and expressive, but it introduces some overhead. Since <code>samtools</code> is a function and not an executable file, there will be situations in which it doesn’t behave as running the typical command. There could also be some scenarios where passing arguments to the <code>samtools</code> command in the container through the <code>samtools</code> function doesn’t behave as expected.</p>
<p>Long story short: beware of edge cases.</p>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="simplify-script-use-function-to-simulate-loading-software" class="slide level2 smaller">
<h2>Simplify script – Use function to simulate “loading” software</h2>
<p>Most significant refactor: Replace individual <code>apptainer exec</code> commands with calls to <code>samtools</code> function</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>compute_bam_stats.sh</strong></pre>
</div>
<div class="sourceCode" id="cb37" data-filename="compute_bam_stats.sh"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb37-1"><a></a><span class="co"># get input bam file from command line argument</span></span>
<span id="cb37-2"><a></a><span class="va">input_bam</span><span class="op">=</span><span class="st">"</span><span class="va">${1}</span><span class="st">"</span></span>
<span id="cb37-3"><a></a><span class="bu">echo</span> <span class="st">"Input BAM file: </span><span class="va">${input_bam}</span><span class="st">"</span></span>
<span id="cb37-4"><a></a></span>
<span id="cb37-5"><a></a><span class="co"># make function to execute Samtools in Apptainer container</span></span>
<span id="cb37-6"><a></a><span class="kw">function</span><span class="fu"> samtools</span> <span class="kw">{</span></span>
<span id="cb37-7"><a></a>  <span class="bu">local</span> <span class="va">img_uri</span><span class="op">=</span><span class="st">"https://depot.galaxyproject.org/singularity/samtools:1.21--h50ea8bc_0"</span></span>
<span id="cb37-8"><a></a>  <span class="ex">apptainer</span> exec <span class="st">"</span><span class="va">${img_uri}</span><span class="st">"</span> samtools <span class="st">"</span><span class="va">${@}</span><span class="st">"</span></span>
<span id="cb37-9"><a></a><span class="kw">}</span></span>
<span id="cb37-10"><a></a></span>
<span id="cb37-11"><a></a><span class="co"># print alignment stats</span></span>
<span id="cb37-12"><a></a><span class="bu">echo</span> <span class="st">"Number records in BAM:"</span></span>
<span id="cb37-13"><a></a><span class="ex">samtools</span> view <span class="at">-c</span> <span class="st">"</span><span class="va">${input_bam}</span><span class="st">"</span></span>
<span id="cb37-14"><a></a><span class="bu">echo</span> <span class="st">"BAM quick stats:"</span></span>
<span id="cb37-15"><a></a><span class="ex">samtools</span> flagstat <span class="st">"</span><span class="va">${input_bam}</span><span class="st">"</span></span>
<span id="cb37-16"><a></a></span>
<span id="cb37-17"><a></a><span class="co"># print alignment stats for high quality alignments</span></span>
<span id="cb37-18"><a></a><span class="bu">echo</span> <span class="st">"Number high quality records in BAM:"</span></span>
<span id="cb37-19"><a></a><span class="ex">samtools</span> view <span class="at">-c</span> <span class="at">-q</span> 10 <span class="st">"</span><span class="va">${input_bam}</span><span class="st">"</span></span>
<span id="cb37-20"><a></a><span class="bu">echo</span> <span class="st">"High quality BAM quick stats:"</span></span>
<span id="cb37-21"><a></a><span class="ex">samtools</span> view <span class="at">-h</span> <span class="at">-q</span> 10 <span class="st">"</span><span class="va">${input_bam}</span><span class="st">"</span> <span class="kw">|</span> <span class="ex">samtools</span> flagstat <span class="at">-</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>

<div class="quarto-auto-generated-content">
<div class="footer footer-default">

</div>
</div>
</section></section>
    </div>
  </div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="../site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="../site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="../site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="../site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="../site_libs/revealjs/plugin/search/search.js"></script>
  <script src="../site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="../site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: false,

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button', {
        text: function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
        }
      });
      clipboard.on('success', function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      });
        var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
        var mailtoRegex = new RegExp(/^mailto:/);
          var filterRegex = new RegExp("https:\/\/trev-f\.github\.io\/hpc-containers-crash-course\/");
        var isInternal = (href) => {
            return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
        }
        // Inspect non-navigation links and adorn them if external
     	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
        for (var i=0; i<links.length; i++) {
          const link = links[i];
          if (!isInternal(link.href)) {
            // undo the damage that might have been done by quarto-nav.js in the case of
            // links that we want to consider external
            if (link.dataset.originalHref !== undefined) {
              link.href = link.dataset.originalHref;
            }
          }
        }
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note) {
            return note.innerHTML;
          } else {
            return "";
          }
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>